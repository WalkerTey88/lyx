<!DOCTYPE html><html lang="zh" translate="no">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover">
<title>龍運轩ᝰ美食中心 · 点单系统</title>
<meta name="color-scheme" content="light">
<style>
/* ===== 主题：高端红包风（红底 / 金色文字与描边） ===== */
:root{
  --bg:#7a0e12;         /* 深红背景 */
  --bg-grad:linear-gradient(180deg,#7a0e12 0%,#6b0c10 40%,#5a0a0d 100%);
  --card:#8f1b1f;       /* 卡片红 */
  --panel:#9b262a;      /* 面板红 */
  --ink:#f7d77b;        /* 主题金色（文本） */
  --ink-d:#e0c468;      /* 稍暗金 */
  --line:#f1d58a;       /* 金色描边 */
  --mut:#f4e7b6;        /* 次级金 */
  --chip:#f3dc8a;       /* 金色浅底 */
  --chip-ink:#7a0e12;   /* 金色浅底上的字 */
  --ok:#1a9a5b; --danger:#d33; --shadow:0 10px 30px rgba(0,0,0,.35)
}
/* Reset & 基础排版 */
*{box-sizing:border-box;-webkit-tap-highlight-color:transparent}
html,body{margin:0;height:100%;background:var(--bg);background-image:var(--bg-grad);color:var(--ink);font-family:system-ui,-apple-system,"Segoe UI",Roboto,Helvetica,Arial,"Noto Sans SC","PingFang SC",sans-serif}
a{color:var(--ink);text-decoration:none}
button{font:inherit}
.container{max-width:980px;margin:0 auto;padding:14px}
.shadow{box-shadow:var(--shadow)}
.card{background:linear-gradient(180deg,rgba(255,255,255,.04),rgba(255,255,255,.02));
      border:1.5px solid var(--line);border-radius:18px;padding:14px}/* 顶部：logo + 语言 */ header{position:sticky;top:0;z-index:10;background:linear-gradient(180deg,rgba(0,0,0,.35),rgba(0,0,0,0));backdrop-filter:saturate(120%) blur(6px);border-bottom:1px solid rgba(241,213,138,.35)} .head{display:flex;align-items:center;gap:12px;padding:10px 14px} header .logo{height:70px;width:auto;max-width:205px;border-radius:10px;display:block;box-shadow:0 6px 18px rgba(0,0,0,.35);background:#fff0} .langs{margin-left:auto;display:flex;gap:8px;flex-wrap:wrap} .langs button{border:1.5px solid var(--line);background:var(--chip);color:var(--chip-ink);padding:8px 14px;border-radius:999px;cursor:pointer} .langs button.active{background:transparent;color:var(--ink);box-shadow:0 0 0 2px rgba(241,213,138,.6) inset}

/* 表单元素 */ label{display:block;margin:8px 0 6px;font-weight:600} input[type="text"],select,textarea{width:100%;padding:12px 14px;border-radius:12px;border:1.5px solid var(--line);background:rgba(0,0,0,.15);color:var(--ink)} textarea{min-height:80px;resize:vertical} .row{display:grid;grid-template-columns:1fr 1fr;gap:12px} @media (max-width:680px){.row{grid-template-columns:1fr}}

/* 分类块 */ .cat{margin:14px 0;border:1.5px dashed var(--line);border-radius:18px;overflow:hidden} .cat-h{display:flex;align-items:center;justify-content:space-between;padding:14px 16px;background:rgba(255,255,255,.06);cursor:pointer} .cat-h h3{margin:0;font-size:18px;letter-spacing:.3px} .cat-b{display:none;padding:12px 12px 16px;background:rgba(0,0,0,.08)} .grid{display:grid;grid-template-columns:repeat(2,minmax(0,1fr));gap:10px} @media (max-width:680px){.grid{grid-template-columns:1fr}} .item{background:rgba(255,255,255,.06);border:1.5px solid var(--line);border-radius:14px;padding:10px} .item h4{margin:0 0 6px;font-size:16px} .item .price{font-weight:700} .item .act{margin-top:8px;display:flex;gap:8px} .btn{border:1.5px solid var(--line);background:var(--chip);color:var(--chip-ink);padding:10px 14px;border-radius:12px;cursor:pointer} .btn.ghost{background:transparent;color:var(--ink)} .btn.full{width:100%} .btn.ok{border-color:#9be4c2;background:#c9f0df;color:#085b38} .btn.bad{border-color:#f3b4b4;background:#ffd4d4;color:#6b0c10}

/* 小节标题（要求金色更显眼） */ .subh{margin:8px 2px 6px;font-weight:800;font-size:15px;letter-spacing:.5px;background:linear-gradient(90deg,#ffe9a8,#f7d77b,#ffe9a8);-webkit-background-clip:text;background-clip:text;color:transparent}

/* 购物车 */ .cart{margin-top:16px} .cart table{width:100%;border-collapse:collapse;border:1.5px solid var(--line);overflow:hidden;border-radius:14px} .cart th,.cart td{padding:10px;border-bottom:1px dashed rgba(241,213,138,.55);text-align:left} .cart tfoot td{font-weight:800} .actions{display:grid;grid-template-columns:1fr 1fr;gap:10px;margin-top:10px} @media (max-width:680px){.actions{grid-template-columns:1fr}} .kpis{margin-top:12px;display:grid;grid-template-columns:repeat(3,1fr);gap:10px} @media (max-width:680px){.kpis{grid-template-columns:1fr 1fr}} .kpis .chip{background:rgba(0,0,0,.12);border:1.5px solid var(--line);border-radius:14px;padding:12px;text-align:center}

/* 打印小票（仅打印可见） */ @media print{ body{background:#fff;color:#000} header,.no-print{display:none !important} .ticket{display:block} } .ticket{display:none} .ticket h2{margin:0 0 8px} .hr{height:1px;background:repeating-linear-gradient(to right,#000 0,#000 6px,transparent 6px,transparent 12px);opacity:.5;margin:8px 0} </style>

</head>
<body>
<header class="shadow">
  <div class="head container">
    <img class="logo" src="logo.png" alt="LYX">
    <div class="langs">
      <button data-lang="zh" class="active">中文</button>
      <button data-lang="en">English</button>
      <button data-lang="vi">Tiếng Việt</button>
    </div>
  </div>
</header><div class="container">
  <!-- 订单基本信息 -->
  <div class="card">
    <div class="row">
      <div>
        <label data-i="table_label">桌号</label>
        <input id="tableNo" type="text" placeholder="A1 / B3 / 打包写TA">
      </div>
      <div>
        <label data-i="type_label">用餐方式</label>
        <select id="type">
          <option value="dinein" data-i="dinein">堂食</option>
          <option value="takeaway" data-i="takeaway">外带</option>
        </select>
      </div>
    </div>
  </div>  <!-- 分类容器 -->  <div id="cats"></div>  <!-- 购物车 -->  <div class="cart card">
    <h3 data-i="cart">订单 / Cart</h3>
    <table id="cartTable">
      <thead>
        <tr><th data-i="item">品项</th><th data-i="qty">数量</th><th data-i="price">价格</th><th class="no-print" data-i="op">操作</th></tr>
      </thead>
      <tbody></tbody>
      <tfoot>
        <tr><td colspan="2" data-i="total">合计 Total</td><td id="total">RM 0.00</td><td class="no-print"></td></tr>
      </tfoot>
    </table><label style="margin-top:10px" data-i="note_label">备注</label>
<textarea id="note" placeholder="例如：少甜 / 少冰 / 加辣" data-i-ph="note_ph"></textarea>

<div class="actions no-print">
  <button class="btn ok full" id="submitBtn" data-i="submit">提交订单（写入表格）</button>
  <button class="btn ghost full" id="printBtn" data-i="print">打印小票</button>
  <button class="btn full" id="exportBtn" data-i="export">导出本单 CSV</button>
  <button class="btn bad full" id="clearBtn" data-i="clear">清空当前订单</button>
</div>

<div class="kpis no-print">
  <div class="chip"><div data-i="k1">订单笔数</div><div id="k_orders" style="font-weight:800;font-size:18px">0</div></div>
  <div class="chip"><div data-i="k2">售出件数</div><div id="k_items" style="font-weight:800;font-size:18px">0</div></div>
  <div class="chip"><div data-i="k3">销售金额</div><div id="k_amount" style="font-weight:800;font-size:18px">RM 0.00</div></div>
</div>

  </div>  <!-- 打印小票视图 -->  <div class="ticket">
    <h2>龍運轩 · 小票</h2>
    <div id="t_info"></div>
    <div class="hr"></div>
    <div id="t_items"></div>
    <div class="hr"></div>
    <div id="t_total"></div>
    <div>谢谢惠顾 · Terima kasih</div>
  </div>
</div><script>
/* ====== Cloud Sync 配置（替换你的值） ====== */
const CLOUD = {
  ENDPOINT: 'https://script.google.com/macros/s/AKfycby84C0cXqeQzruVq9U5MdSCwur8V42yMNTKPW0909cNx1NBUk0LUbPDQrht588HEuUOhA/exec',
  SECRET:   'Lyx115599$api',
  SPREADSHEET_ID: '1mEx1LPaFYsBisXs5mOp-TA_P_9ntfpvMSVzdyKUveKk'
};

/* ====== I18N（页面UI） ====== */
let LANG = 'zh';
const I18N = {
  table_label:{zh:"桌号",en:"Table",vi:"Bàn"},
  type_label:{zh:"用餐方式",en:"Service Type",vi:"Hình thức"},
  dinein:{zh:"堂食",en:"Dine-in",vi:"Ăn tại chỗ"},
  takeaway:{zh:"外带",en:"Takeaway",vi:"Mang đi"},
  cart:{zh:"订单 / Cart",en:"Cart",vi:"Giỏ hàng"},
  item:{zh:"品项",en:"Item",vi:"Món"},
  qty:{zh:"数量",en:"Qty",vi:"SL"},
  price:{zh:"价格",en:"Price",vi:"Giá"},
  op:{zh:"操作",en:"Action",vi:"Tác vụ"},
  total:{zh:"合计 Total",en:"Total",vi:"Tổng"},
  note_label:{zh:"备注",en:"Note",vi:"Ghi chú"},
  note_ph:{zh:"例如：少甜 / 少冰 / 加辣",en:"e.g. less sweet / less ice / spicy",vi:"vd: ít ngọt / ít đá / cay"},
  submit:{zh:"提交订单（写入表格）",en:"Submit Order (to Sheet)",vi:"Gửi đơn (ghi vào Sheet)"},
  print:{zh:"打印小票",en:"Print Ticket",vi:"In hoá đơn"},
  export:{zh:"导出本单 CSV",en:"Export CSV (this order)",vi:"Xuất CSV"},
  clear:{zh:"清空当前订单",en:"Clear",vi:"Xoá"},
  k1:{zh:"订单笔数",en:"Orders",vi:"Số đơn"},
  k2:{zh:"售出件数",en:"Items",vi:"Mặt hàng"},
  k3:{zh:"销售金额",en:"Amount",vi:"Doanh thu"},
  cat_wonton:{zh:"龍兴记ᝰ云吞面",en:"Wonton Noodles",vi:"Mì hoành thánh"},
  cat_drinks:{zh:"饮料",en:"Drinks",vi:"Đồ uống"},
  cat_auntie:{zh:"婶婶档",en:"Auntie Stall",vi:"Gian hàng Cô"},
  cat_gx:{zh:"广西卷筒粉",en:"Guangxi Rice Rolls",vi:"Bánh cuốn Quảng Tây"},
  add:{zh:"加入",en:"Add",vi:"Thêm"},
  minus:{zh:"-1",en:"-1",vi:"-1"}
};
function t(key){return (I18N[key]&&I18N[key][LANG])||key}
function applyI18N(){
  document.querySelectorAll('[data-i]').forEach(el=>el.textContent=t(el.getAttribute('data-i')));
  document.querySelectorAll('[data-i-ph]').forEach(el=>el.placeholder=t(el.getAttribute('data-i-ph')));
}

/* ====== 菜单数据（按你提供的清单；带分组小节） ====== */
// 结构：每个分类下设 sections（小节标题+items）。小节标题用 .subh 金色强调。
const MENU = [
  { key:'cat_wonton', sections:[
    {title:'干捞 〇 面类', items:[
      {name:'面→干捞（小）', price:6.50},
      {name:'面→干捞（中）', price:7.30},
      {name:'面→干捞（大）', price:8.00},
    ]},
    {title:'干捞 〇 面薄', items:[
      {name:'面薄→干捞（小）', price:6.50},
      {name:'面薄→干捞（中）', price:7.30},
      {name:'面薄→干捞（大）', price:8.00},
    ]},
    {title:'汤底 〇 面', items:[
      {name:'面→汤底（小）', price:6.50},
      {name:'面→汤底（中）', price:7.30},
      {name:'面→汤底（大）', price:8.00},
    ]},
    {title:'汤底 〇 面薄', items:[
      {name:'面薄→汤底（小）', price:6.50},
      {name:'面薄→汤底（中）', price:7.30},
      {name:'面薄→汤底（大）', price:8.00},
    ]},
    {title:'〇云吞', items:[
      {name:'干捞<云吞>（一份）', price:5.00},
      {name:'汤<云吞>（一份）', price:5.00},
      {name:'加料：云吞 ×3颗', price:1.00},
    ]},
  ]},
  { key:'cat_drinks', sections:[
    {title:'〇咖啡类', items:[
      {name:'咖啡（热）', price:2.30},
      {name:'咖啡（冰）', price:2.50},
      {name:'咖啡C（热）', price:2.50},
      {name:'咖啡C（冰）', price:2.70},
      {name:'咖啡O（热）', price:2.00},
      {name:'咖啡O（冰）', price:2.20},
    ]},
    {title:'〇奶茶类', items:[
      {name:'奶茶（热）', price:2.30},
      {name:'奶茶（冰）', price:2.50},
      {name:'奶茶C（热）', price:2.50},
      {name:'奶茶C（冰）', price:2.70},
      {name:'奶茶咸C（热）', price:2.50},
      {name:'奶茶咸C（冰）', price:2.70},
    ]},
    {title:'〇Milo', items:[
      {name:'Milo（热）', price:2.60},
      {name:'Milo（冰）', price:2.80},
      {name:'Milo C（热）', price:2.80},
      {name:'Milo C（冰）', price:3.00},
      {name:'Milo O（热）', price:2.60},
      {name:'Milo O（冰）', price:2.80},
    ]},
    {title:'〇Nestle / Nescafe', items:[
      {name:'Nestle（热）', price:2.80},
      {name:'Nescafe（热）', price:2.80},
      {name:'Nescafe（冰）', price:3.00},
    ]},
    {title:'〇凉茶类 / 其它', items:[
      {name:'凉茶（热）', price:1.50},
      {name:'凉茶（冰）', price:1.70},
      {name:'罐装水', price:2.50},
    ]},
    {title:'〇蛋类 / 面包', items:[
      {name:'生熟蛋 “1set”', price:2.40},
      {name:'烤面包 “1set”', price:1.80},
      {name:'蒸面包 “1set”', price:1.80},
      {name:'烤圆包 “1set”', price:2.00},
      {name:'蒸圆包 “1set”', price:2.00},
    ]},
  ]},
  { key:'cat_auntie', sections:[
    {title:'', items:[
      {name:'苦瓜米粉', price:6.00},
      {name:'Nasi Lemak（有鸡肉）', price:6.00},
      {name:'Nasi Lemak（只有鸡蛋）', price:3.00},
      {name:'面粉糕', price:6.00},
      {name:'红烧饭', price:6.00},
      {name:'鱼粥（猪肉）', price:6.00},
      {name:'鱼粥（鸡肉）', price:6.00},
      {name:'面线', price:6.00},
      {name:'卤肉饭', price:6.00},
      {name:'果条汤', price:6.00},
      {name:'加皮蛋', price:1.00},
      {name:'酸笋瓜', price:1.50},
      {name:'酸羊角豆', price:1.50},
      {name:'酸苦瓜', price:1.50},
      {name:'酸豆腐', price:1.50},
      {name:'炸鸡翅膀', price:3.00},
      {name:'煎鸡蛋', price:1.00},
    ]},
  ]},
  { key:'cat_gx', sections:[
    {title:'', items:[
      {name:'素粉 (kosong)', price:1.00},
      {name:'蔬菜卷筒粉', price:2.00},
      {name:'菜加肉卷筒粉', price:3.00},
      {name:'肉卷筒粉', price:3.00},
      {name:'全家福卷筒粉', price:4.00},
      {name:'春卷', price:1.00},
      {name:'芋头米糕', price:1.00},
    ]},
  ]},
];

/* ====== 生成分类UI（支持分组小节） ====== */
const catsEl = document.getElementById('cats');
MENU.forEach((cat)=>{
  const wrap = document.createElement('div'); wrap.className='cat card';
  wrap.innerHTML = `
    <div class="cat-h" data-toggle>
      <h3>${t(cat.key)}</h3>
      <div style="opacity:.8">${LANG==='zh'?'点击展开/收起':LANG==='vi'?'Mở/Đóng':'Expand/Collapse'}</div>
    </div>
    <div class="cat-b"></div>`;
  const body = wrap.querySelector('.cat-b');
  cat.sections.forEach(sec=>{
    if(sec.title){
      const h = document.createElement('div'); h.className='subh'; h.textContent=sec.title; body.appendChild(h);
    }
    const grid = document.createElement('div'); grid.className='grid';
    grid.innerHTML = sec.items.map((it)=>`
      <div class="item">
        <h4>${it.name}</h4>
        <div class="price">RM ${Number(it.price).toFixed(2)}</div>
        <div class="act">
          <button class="btn" data-add='${it.name}__${it.price}'>${t('add')}</button>
          <button class="btn ghost" data-sub='${it.name}__${it.price}'>${t('minus')}</button>
        </div>
      </div>
    `).join('');
    body.appendChild(grid);
  });
  catsEl.appendChild(wrap);
});

catsEl.addEventListener('click',e=>{
  const h = e.target.closest('[data-toggle]');
  if(h){ const b=h.parentElement.querySelector('.cat-b'); b.style.display = b.style.display==='block'?'none':'block'; }
});

/* ====== 购物车 ====== */
let CART = []; // {name, price, qty}
function addToCart(name,price,delta=1){
  const p = Number(price);
  const found = CART.find(x=>x.name===name && x.price===p);
  if(found){ found.qty += delta; if(found.qty<=0) CART=CART.filter(x=>x!==found); }
  else if(delta>0){ CART.push({name,price:p,qty:1}); }
  renderCart();
}

catsEl.addEventListener('click',e=>{
  const ad = e.target.getAttribute('data-add');
  const sb = e.target.getAttribute('data-sub');
  if(ad){ const [n,p]=ad.split('__'); addToCart(n,p,1); }
  if(sb){ const [n,p]=sb.split('__'); addToCart(n,p,-1); }
});

function renderCart(){
  const tb = document.querySelector('#cartTable tbody'); tb.innerHTML='';
  let total=0, items=0;
  CART.forEach((it,idx)=>{
    total += it.qty*it.price; items += it.qty;
    const tr=document.createElement('tr');
    tr.innerHTML = `<td>${it.name}</td>
      <td>${it.qty}</td>
      <td>RM ${(it.qty*it.price).toFixed(2)}</td>
      <td class="no-print">
        <button class="btn" onclick="addToCart('${it.name}',${it.price},1)">+1</button>
        <button class="btn ghost" onclick="addToCart('${it.name}',${it.price},-1)">-1</button>
        <button class="btn bad" onclick="removeIdx(${idx})">移除</button>
      </td>`;
    tb.appendChild(tr);
  });
  document.getElementById('total').textContent='RM '+total.toFixed(2);
  // KPI（仅本地演示）
  document.getElementById('k_items').textContent = items;
  document.getElementById('k_amount').textContent = 'RM '+total.toFixed(2);
}
function removeIdx(i){ CART.splice(i,1); renderCart(); }
renderCart();

/* ====== 导出 CSV（当前订单） ====== */
function exportCSV(){
  const rows=[["Item","Qty","Unit Price","Amount"]];
  let total=0;
  CART.forEach(it=>{ const amt=it.qty*it.price; total+=amt; rows.push([it.name,it.qty,it.price,amt]); });
  rows.push(["Total","","",total.toFixed(2)]);
  const csv=rows.map(r=>r.map(v=>`"${String(v).replace(/"/g,'""')}"`).join(',')).join('\n');
  const blob=new Blob([csv],{type:'text/csv;charset=utf-8;'});
  const a=document.createElement('a'); a.href=URL.createObjectURL(blob); a.download='order.csv'; a.click();
}

/* ====== 打印小票 ====== */
function printTicket(){
  const tInfo = document.getElementById('t_info');
  const tItems = document.getElementById('t_items');
  const tTotal = document.getElementById('t_total');
  const table = document.getElementById('tableNo').value.trim();
  const type  = document.getElementById('type').value;
  tInfo.textContent = `桌号: ${table||'-'} · ${type==='dinein'?t('dinein'):t('takeaway')}`;
  tItems.innerHTML = CART.map(it=>`${it.name} x${it.qty} — RM ${(it.qty*it.price).toFixed(2)}`).join('<br>');
  const sum = CART.reduce((s,it)=>s+it.qty*it.price,0);
  tTotal.textContent = '合计: RM '+sum.toFixed(2);
  window.print();
}

/* ====== 提交订单到 Google Apps Script（与你后端一致） ====== */
async function submitOrder(){
  if(!CART.length){ alert('请先加入商品'); return; }
  const body = {
    secret: CLOUD.SECRET,
    spreadsheetId: CLOUD.SPREADSHEET_ID,
    table: (document.getElementById('tableNo').value||'').trim(),
    type: document.getElementById('type').value,      // dinein / takeaway
    note: (document.getElementById('note').value||'').trim(),
    items: CART.map(it=>({ name:it.name, qty:it.qty, price:it.price })),
    total: CART.reduce((s,it)=>s+it.qty*it.price,0)
  };
  try{
    const res = await fetch(CLOUD.ENDPOINT, {
      method:'POST', headers:{'Content-Type':'application/json'},
      body: JSON.stringify(body)
    });
    const j = await res.json();
    if(!j || j.ok!==true){ throw new Error(j && j.error || 'unknown'); }
    // 简单本地 KPI：累加订单笔数
    const k = document.getElementById('k_orders'); k.textContent = (+k.textContent||0)+1;
    alert('已提交成功 ✅');
    // 清空
    CART=[]; renderCart(); document.getElementById('note').value='';
  }catch(err){
    console.error(err); alert('提交失败：'+err.message);
  }
}

/* ====== 事件绑定 ====== */
document.getElementById('exportBtn').onclick = exportCSV;
document.getElementById('printBtn').onclick  = printTicket;
document.getElementById('submitBtn').onclick = submitOrder;
document.getElementById('clearBtn').onclick  = ()=>{ if(confirm('确定清空当前订单？')){ CART=[]; renderCart(); } };

/* ====== 语言切换 ====== */
document.querySelectorAll('.langs button').forEach(b=>{
  b.onclick = ()=>{
    document.querySelectorAll('.langs button').forEach(x=>x.classList.remove('active'));
    b.classList.add('active');
    LANG = b.getAttribute('data-lang');
    // 更新分类标题
    document.querySelectorAll('#cats .cat').forEach((wrap,i)=>{
      wrap.querySelector('.cat-h h3').textContent = t(MENU[i].key);
    });
    applyI18N();
  };
});
applyI18N();
</script></body>
</html>
